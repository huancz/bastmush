<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, May 08, 2009, 10:32 AM -->
<!-- MuClient version 4.40 -->

<!-- Plugin "AreaInfo" generated by Plugin Wizard -->

<muclient>
<plugin
   name="xBroadcast_Area"
   author="Bast"
   id="aaa2beeda10fa11787c6b438"
   language="Lua"
   purpose="To get info from the areas command"
   save_state="y"
   date_written="2009-05-08 10:31:50"
   requires="4.40"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="n"
   match="^\s*(?&lt;from&gt;\d+)\s+(?&lt;to&gt;\d+)\s+(?&lt;lock&gt;\d+)\s+(?&lt;author&gt;.+?)(  )+?(?&lt;name&gt;.+?)\s*$"
   sequence="100"
   script="parsearea"
   regexp="y"
   group="areareg"
  >
  </trigger>
  <trigger
   enabled="n"
   match="^\s*(?&lt;from&gt;\d+)\s+(?&lt;to&gt;\d+)\s+(?&lt;author&gt;.+?)(  )+?(?&lt;name&gt;.+?)\s*$"
   sequence="101"
   script="parsearea"
   regexp="y"
   name="nolock"
   group="areareg"
  >
  </trigger>
  <trigger
   enabled="n"
   match="^---------------------------------------------------------------$"
   sequence="101"
   script="areas_done"
   regexp="y"
   group="area"
  >
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   name="areastart"
   script="areas_start"
   match="^areas$"
   enabled="y"
   regexp="y"
   sequence="100"
  >
  <send>areas</send>
  </alias>

</aliases>

<!--  Script  -->

<script>
<![CDATA[

require "var"
require "pluginhelper"
require "serialize"
require "commas"
require "verify"
require "tprint"

function parsearea (name, line, wildcards)
  area = {}
  area.name = trim(wildcards.name)
  area.author = trim(wildcards.author)
  area.to = wildcards.to
  area.from = wildcards.from
  area.speedwalk = ''
  area.keyword = ''
  if name == "nolock" then
    area.lock = 0
  else
    area.lock = wildcards.lock
  end
  areainfo = serialize.save( "area", area )
  broadcast(1, areainfo, areainfo)
end

function areas_start(name, line, wildcards)
  enabletriggroup("areareg", true)
  enabletriggroup("area", true)
end

function areas_done(name, line, wildcards)
  enabletriggroup("areareg", false)
  enabletriggroup("area", false)
  broadcast(2)
end

]]>
</script>

<script>
<![CDATA[

function OnPluginBroadcast (msg, id, name, text)
  PluginhelperOnPluginBroadcast(msg, id, name, text)
end

function OnPluginInstall ()
  --OnPluginEnable is automatically called by pluginhelper

  PluginhelperOnPluginInstall()
end -- OnPluginInstall

function OnPluginClose ()

  PluginhelperOnPluginClose()
end -- OnPluginClose

function OnPluginEnable ()

  PluginhelperOnPluginEnable()
end -- OnPluginEnable

function OnPluginDisable ()

  PluginhelperOnPluginDisable()
end -- OnPluginDisable

function OnPluginConnect ()

  PluginhelperOnPluginConnect()
end -- function OnPluginConnect

function OnPluginDisconnect ()

  PluginhelperOnPluginDisonnect()
end -- function OnPluginConnect

function OnPluginSaveState ()

  PluginhelperOnPluginSaveState()
end -- function OnPluginSaveState

]]>
</script>

<aliases>
  <alias
   name="plugin_parse"
   script="plugin_parse_helper"
   match="nothing"
   enabled="y"
   regexp="y"
   ignore_case="y"
   sequence="110"
   expand_variables="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[

option_set_default('cmd', 'areac')
option_set_default('plugin_colour', 'cyan')

init_plugin_vars()
set_plugin_alias()

]]>

</script>
</muclient>
