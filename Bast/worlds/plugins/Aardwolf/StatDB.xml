<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, May 01, 2009, 9:25 PM -->
<!-- MuClient version 4.40 -->

<!-- Plugin "StatsSave" generated by Plugin Wizard -->

<muclient>
<plugin
   name="StatDB"
   author="Bast"
   id="a749d26f1cb3e00282727e55"
   language="Lua"
   purpose="Save stats to a sqlite3 db"
   save_state="y"
   date_written="2009-05-01 21:24:06"
   requires="4.40"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<script>
<![CDATA[
require "var"
require "serialize"
require "commas"
require "pluginhelper"
require "verify"
require "statsdb"

db = Statdb{}

function savelevel()
  local pvar = GetPluginVariable(  "aaa0ab9ed92f8fc614664bd1" , "levelinfo")

  --get the mob info
  loadstring( pvar )()
  levelgains = levelinfo  
  db:savelevel(levelgains)      
end

function savequest()
  local quest_total = -1
  local quest_avg = 0
  local pvar = GetPluginVariable(  "aaa8a9eda20fa11787c6b438" , "quest_info")

  --get the quest info
  loadstring( pvar )()
  quest_stuff = quest_info
  db:savequest(quest_stuff)
end

function savecp()
  local pvar = GetPluginVariable(  "aaa66f81c50828bbbfda7100" , "cp_info")

  --get the cp info
  loadstring( pvar )()
  cp_stuff = cp_info
   cpgains = tostring(cp_stuff.qp)
   db:savecp(cp_stuff)
end

function savewhois()
  local pvar = GetPluginVariable(  "aaaf9a8dc92f8fc614663ac0" , "whoisinfo")

  --get the whois stuff
  loadstring( pvar )()
  db:savewhois(  whoisinfo  )
end

function savemobkill()
  local pvar = GetPluginVariable(  "aaa61c4570508448e19c7c14", "kill_info")

  -- get the kill
  loadstring( pvar )()
  db:savemobkill( kill_info )
end

function savegq()
  local pvar = GetPluginVariable(  "aaa77f81c5408278ccda7100", "gq_info")

  -- get the gqquest
  loadstring( pvar )()
  db:savegq( gq_info )
end

function OnPluginBroadcast (msg, id, name, text)
  if id == "aaa8a9eda20fa11787c6b438" and (msg == 6 or msg == 8) then
    savequest()        
  elseif id == "aaa0ab9ed92f8fc614664bd1" and msg == 1 then
    savelevel()
  elseif id == "aaaf9a8dc92f8fc614663ac0" and msg == 1 then
    savewhois()
  elseif id == "aaa66f81c50828bbbfda7100" and (msg == 3 or msg == 4) then
    savecp()  
  elseif id == "aaa61c4570508448e19c7c14" and msg == 1 then
    savemobkill()  
  elseif id == "aaa77f81c5408278ccda7100" and msg == 4 then
    savegq()  
  end
end -- OnPluginBroadcast

]]>
</script>

<aliases>
  <alias
   name="plugin_parse"
   script="plugin_parse"
   match="nothing"
   enabled="y"
   regexp="y"
   ignore_case="y"
   sequence="110"
   expand_variables="y"
  >
  </alias>   
</aliases>

<script>
<![CDATA[

options_table  = {
  tdebug = {help="set this for debugging information", type="bool", default=verify_bool(false)},
  plugin_colour = {help="set the plugin colour", type="colour", default=verify_colour("orange")},
  cmd = {help="the command for this plugin", type="string", after=set_plugin_alias, default="statsave"},
}

cmds_table = {

}
  
function plugin_parse (name, line, wildcards)
  plugin_parse_helper(name, line, wildcards, cmds_table, options_table)
end -- plugin_parse

init_plugin_vars(options_table)
set_plugin_alias()
]]>
</script>
</muclient>

